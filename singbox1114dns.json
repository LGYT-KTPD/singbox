{
  "log": { "disabled": false, "level": "info", "timestamp": true },

  "dns": {
    "fakeip": {
      "enabled": true,
      "inet4_range": "198.18.0.0/15"
      // 注意：不配置 inet6_range = 关闭 fake IPv6
    },
    "servers": [
      { "tag": "google", "address": "https://8.8.8.8/dns-query", "detour": "proxy" },
      { "tag": "ali",    "address": "https://223.5.5.5/dns-query", "detour": "direct" },
      { "tag": "fakeip", "address": "fakeip" }
    ],
    "rules": [
      { "outbound": "any", "action": "route", "server": "ali", "disable_cache": true },
      { "clash_mode": "Direct", "action": "route", "server": "ali" },
      { "clash_mode": "Global", "action": "route", "server": "fakeip" },

      { "query_type": "HTTPS", "action": "reject" },               // 阻止浏览器内置 DoH 绕过
      { "query_type": ["A","AAAA"], "action": "route", "server": "fakeip", "rewrite_ttl": 1 },

      { "rule_set": "cn_domain", "action": "route", "server": "ali" }
    ],
    "final": "google",
    "independent_cache": true
  },

  "route": {
    "rules": [
      { "action": "sniff", "sniffer": ["http","tls","quic","dns"], "timeout": "500ms" },

      { "type": "logical", "mode": "or", "rules": [ { "port": 53 }, { "protocol": "dns" } ], "action": "hijack-dns" },

      { "ip_is_private": true, "action": "route", "outbound": "direct" },

      { "clash_mode": "Global", "action": "route", "outbound": "proxy" },
      { "clash_mode": "Direct", "action": "route", "outbound": "direct" },

      { "action": "resolve" },

      { "rule_set": ["cn_ip","cn_domain"], "action": "route", "outbound": "direct" }
    ],

    "rule_set": [
      { "tag": "cn_ip",      "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/sing/geo/geoip/cn.srs",         "download_detour": "direct" },
      { "tag": "cn_domain",  "type": "remote", "format": "binary", "url": "https://ghfast.top/https://raw.githubusercontent.com/MetaCubeX/meta-rules-dat/refs/heads/sing/geo-lite/geosite/cn.srs",  "download_detour": "direct" }
    ],

    "final": "proxy",
    "auto_detect_interface": true
  },

  "outbounds": [
    {
      "tag": "proxy",
      "type": "selector",
      "outbounds": ["all-auto", "direct"],
      "default": "all-auto"
    },

    {
      "tag": "all-auto",
      "type": "urltest",
      "outbounds": [],
      "url": "https://www.gstatic.com/generate_204",
      "interval": "1m",
      "tolerance": 50
    },

    { "tag": "direct", "type": "direct" }
  ],

  "inbounds": [
    {
      "type": "tun",
      "address": ["172.19.0.0/30"],          // 仅 IPv4
      "stack": "mixed",
      "auto_route": true,
      "platform": {
        "http_proxy": { "enabled": true, "server": "127.0.0.1", "server_port": 7890 }
      }
    },
    { "type": "mixed", "listen": "127.0.0.1", "listen_port": 7890 }
  ],

  "experimental": {
    "cache_file": { "enabled": true, "store_fakeip": true },
    "clash_api": {
      "external_controller": "127.0.0.1:9090",
      "external_ui": "ui",
      "external_ui_download_url": "https://ghfast.top/https://github.com/MetaCubeX/metacubexd/archive/refs/heads/gh-pages.zip",
      "external_ui_download_detour": "direct"
    }
  }
}
